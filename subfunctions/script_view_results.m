% A script to review the results generated by two pipelines.
% Input files are Epoched_HFB (new pipeline), SHFBXXX (standard pipeline),
% or Var_guiXX (standard pipeline).
[filename,pathname] = uigetfile({'*.mat','Data format (*.mat)'},...
        'MultiSelect', 'on');
    fname = fullfile(pathname,filename); 
    if iscell(fname)
        head_file = fname;
    else
        head_file{1} = fname;
    end
    
    for i = 1:length(head_file)
        if contains(head_file{i},'Epoched_HFB')
            LBCN_plot_HFB(head_file{i});
        return;
        end
       try
           D{i} = spm_eeg_load(head_file{i});
       catch
           var_file = head_file{i};
           v = load(var_file);
           D = v.df;
           plot_cond = v.plot_cond;
           exclude = v.exclude;
           break;
       end
       try
        var_file = find_file(path(D{1}),'Var_gui',[]);
           v = load(var_file);
           plot_cond = v.plot_cond;
           exclude = v.exclude;
       catch
           plot_cond = [];
           exclude = [];
       end
    end

 signal_all = format_signal([],D,plot_cond,exclude);
 nan_all = format_signal([],D,plot_cond,exclude);
 sparam = 25;
 labels = condlist(D{1});
 t = time(D{1});
 page = 1;
 yl = [-0.3 2];
 w1 = indsample(D{1},t(1));
 w2 = indsample(D{1},t(end));
 window = w1:w2;
 bc_type = 2;
 if isempty(plot_cond)
     plot_cond = 1:length(labels);
 end
 if ~exist('bch','var')
        bch = cell(length(D),1);
 elseif isempty(bch)
     bch = cell(length(D),1);
 end
 plot_window(signal_all, sparam,labels,D,window,plot_cond, page, yl, bch, t, [], bc_type, nan_all);